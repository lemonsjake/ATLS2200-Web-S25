<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/phone-num-final.css" />
    <title>Web JS Final - Frustrating Phone Number - Card Matching</title>
  </head>
  <body>
    <div class="phoneNumContainer">
      <h1 id="phone-num-title">Phone #</h1>
      <h2 id="phone-num">___-___-____</h2>
    </div>

    <div class="resetSubmit">
      <button id="reset">reset</button>
      <button id="submit">submit</button>
    </div>

    <div class="difficulty">
      <h3 id="diff-container-title">Difficulty</h3>
      <div id="easy-mode" class="diffMode">
        <p class="modeTitle">annoying</p>
        <p class="modeInfo">
          <em><strong>16</strong> match<br />attempts</em>
        </p>
      </div>
      <div id="med-mode" class="diffMode">
        <p class="modeTitle">frustrating</p>
        <p class="modeInfo">
          <em><strong>12</strong> match<br />attempts</em>
        </p>
      </div>
      <div id="hard-mode" class="diffMode">
        <p class="modeTitle">ummm...</p>
        <p class="modeInfo">
          <em><strong>8</strong> match<br />attempts</em>
        </p>
      </div>
    </div>

    <!--
      hover over mode:
        mode.bg = white
        mode.modeTitle = bold
      .modeInfo {
        display: none;
      }
    -->

    <div class="instructions">
      <p>Click a card to flip it and see what number it represents.</p>
      <p>
        After flipping 2 cards, they will flip back over unless their backs
        match.
      </p>
      <p>
        If the cards match, they stay flipped and can be used to add that digit
        to your phone number.
      </p>
      <p>If they don't match, your match attempts counter increases by 1.</p>
      <p>
        The experience automatically resets after your match attempts counter
        reaches the value based on your chosen difficulty.
      </p>
      <p>
        Be careful when using matches in your phone number -- you'll need to
        restart since there's no backspace!
      </p>
      <p>Good luck!</p>
    </div>

    <div class="card-container"></div>

    <!-- <script src="phone-num-final.js"></script> -->
    <script>
      // let restart = false;
      let failLimit = 12; // Default med/frustrating difficulty

      let pauseTime = false; // Prevents flipping cards while waiting for timeout
      let fails = 0;
      let numFlips = 0;
      let phoneDigNum = 0;
      let cards = [];
      let flippedIdxs = [];
      let matchedCards = [];
      const cardContainer = document.querySelector(".card-container");
      const cardFaces = [
        "zero",
        "zero",
        "one",
        "one",
        "two",
        "two",
        "three",
        "three",
        "four",
        "four",
        "five",
        "five",
        "six",
        "six",
        "seven",
        "seven",
        "eight",
        "eight",
        "nine",
        "nine",
      ];
      const cardVals = [
        0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9,
      ];

      let resetBtn = document
        .querySelector("#reset")
        .addEventListener("click", resetAll);
      let submitBtn = document
        .querySelector("#submit")
        .addEventListener("click", submitNumber);
      let phoneNum = document.querySelector("#phone-num");
      document.querySelector("#easy-mode").addEventListener("click", () => {
        failLimit = 16; //failLim for easy/annoying difficulty
        updateActiveMode("easy-mode");
        console.log("Difficulty set to 'annoying'. Fail limit:", failLimit);
      });

      document.querySelector("#med-mode").addEventListener("click", () => {
        failLimit = 12; // failLim for med/frustrating difficulty
        updateActiveMode("med-mode");
        console.log("Difficulty set to 'frustrating'. Fail limit:", failLimit);
      });

      document.querySelector("#hard-mode").addEventListener("click", () => {
        failLimit = 8; // failLim for hard/ummm difficulty
        updateActiveMode("hard-mode");
        console.log("Difficulty set to 'ummm...'. Fail limit:", failLimit);
      });

      class Card {
        constructor(card, face, value, idx) {
          this.card = card;
          this.face = face.textContent; // card face (zero-nine)
          this.value = value.textContent; // card value (0-9)
          this.idx = idx;
          this.isFlipped = false;
          this.isMatched = false;
          this.clicksAfterMatch = 0;
          this.card.addEventListener("click", () => {
            if (!this.isFlipped && !pauseTime) {
              this.flip();
            } else {
              console.log("already flipped", this.face, this.value);
            }
          });
          this.card.addEventListener("click", () => {
            if (matchedCards.includes(this)) {
              if (this.clicksAfterMatch > 0) {
                if (phoneDigNum < 0) {
                  console.log(
                    "ERROR: negative phone digit num",
                    phoneDigNum,
                    "\nPlease reset..."
                  );
                } else if (phoneDigNum === 3) {
                  phoneDigNum = 4;
                } else if (phoneDigNum === 7) {
                  phoneDigNum = 8;
                } else if (phoneDigNum > 11) {
                  alert(
                    "UH OH! You entered too many digits. Sorry, no modulus for you. Either reset or submit."
                  );
                  // phoneDigNum = phoneDigNum % 11;
                }

                phoneNum.textContent = phoneNum.textContent.replace(
                  phoneNum.textContent[phoneDigNum],
                  this.value
                );
                console.log("curr phone num", phoneNum.textContent);
                phoneDigNum++;
                console.log("curr phone num digit", phoneDigNum);
              }

              this.clicksAfterMatch++;
            }
          });
        }

        flip() {
          if (this.isFlipped) {
            this.isFlipped = false;
            this.card.classList.remove("flipped");
          } else {
            this.isFlipped = true; // switches card's flip attribute
            this.card.classList.toggle("flipped"); // toggles flipped class
            numFlips++;
            console.log("flips", numFlips);

            flippedIdxs.push(this.idx);

            if (numFlips === 2) {
              console.log("flipped card Idxs", flippedIdxs[0], flippedIdxs[1]);

              if (flippedIdxs.length === 2) {
                console.log(
                  "2 flipped cards with idxs:",
                  flippedIdxs[0],
                  flippedIdxs[1]
                );
                checkMatch(flippedIdxs[0], flippedIdxs[1]);
                numFlips = 0;
                flippedIdxs = []; // reset array of flipped card indices
              } else {
                console.log("error: flippedIdxs", flippedIdxs.length);
              }
            }
          }
          console.log("flipped", this.face, this.value);
        }

        match() {
          this.isMatched = true;
          this.card.classList.add("matched");
        }
      }

      function updateActiveMode(activeModeId) {
        const modes = document.querySelectorAll(".diffMode");
        modes.forEach((mode) => {
          if (mode.id === activeModeId) {
            mode.classList.add("active");
          } else {
            mode.classList.remove("active");
          }
        });
      }

      /* Shuffles cards using Fisher-Yates Shuffle algorithm */
      function shuffle(nums) {
        // Iterates backwards through nums, swapping last elem with an elem at a rand lower index
        for (let i = nums.length - 1; i > 0; i--) {
          let rand = Math.floor(Math.random() * (i + 1));
          let temp = nums[i];
          nums[i] = nums[rand];
          nums[rand] = temp;
        }

        return nums;
      }

      function createCards() {
        let shuffledFaces = shuffle(cardFaces);
        let shuffledVals = shuffle(cardVals);

        for (let i = 0; i < cardFaces.length; i++) {
          const newCard = document.createElement("div");
          const cardFace = document.createElement("p");
          const cardVal = document.createElement("p");
          const idx = i;
          cardFace.textContent = shuffledFaces[i];
          cardFace.classList.add("card-face");
          cardVal.textContent = shuffledVals[i];
          cardVal.classList.add("card-back");
          newCard.classList.add("card");
          newCard.appendChild(cardFace);
          newCard.appendChild(cardVal);
          cards.push(new Card(newCard, cardFace, cardVal, idx));
          cardContainer.appendChild(newCard);
        }
      }

      function resetAll() {
        console.log("resetting experience...");
        phoneNum.textContent = "___-___-____";
        phoneDigNum = 0;
        numFlips = 0;
        fails = 0;
        matchedCards = []; // reset matched cards array
        cards = []; // reset array of card objects
        cardContainer.innerHTML = ""; // remove card HTML elements
        createCards();
        updateActiveMode("med-mode")
      }

      function submitNumber() {
        if (phoneNum.textContent === "___-___-____") {
          alert("No phone number entered!");
        } else if (phoneNum.textContent.includes("_")) {
          alert("Incomplete phone number!");
        } else {
          console.log("submitting num", phoneNum.textContent);
          alert("Your number is " + phoneNumber.textContent);
        }

        return;
      }

      function checkMatch(idx1, idx2) {
        // console.log("checking match", cards[idx1].value, cards[idx2].value);
        if (cards[idx1].value === cards[idx2].value) {
          console.log("MATCH FOUND", cards[idx1].value, cards[idx2].value);
          cards[idx1].match();
          cards[idx2].match();
          matchedCards.push(cards[idx1], cards[idx2]);
        } else {
          fails++;
          console.log("fails", fails);
          pauseTime = true;
          setTimeout(() => {
            cards[idx1].flip();
            cards[idx2].flip();
            numFlips = 0; // reset num cards currently flipped
            flippedIdxs = []; // empty stored flipped card indices
            pauseTime = false;
            if (fails >= failLimit) {
              alert("Match attempt limit reached!");
              resetAll();
            }
          }, 1000); // 1s delay before flipping cards back over
        }
      }

      createCards(); // create cards
      updateActiveMode("med-mode") // set default active difficulty mode
    </script>
  </body>
</html>

<!-- card matching for frustrating phone number js project -->
<!-- //
     0 1 2 3 4 5 6 7 8 9
     0 1 2 3 4 5 6 7 8 9

     0 1 2 3 4
     5 6 7 8 9
     0 1 2 3 4
     5 6 7 8 9
     
     0 1 2 3
     4 5 6 7
     8 9 0 1
     2 3 4 5
     6 7 8 9

     funtions:
        
-->
