<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/phone-num-final.css" />
    <title>Web JS Final - Frustrating Phone Number - Card Matching</title>
  </head>
  <body>
    <h1>Phone #: <span>___-___-___</span></h1>
    <div>
      <p id="phone-num">___-___-____</p>
      <!-- <p class="phoneNum" id="dig-1">_</p>
        <p class="phoneNum" id="dig-2">_</p>
        <p class="phoneNum" id="dig-3">_</p>
        <p class="phoneNum">-</p>
        <p class="phoneNum" id="dig-4">_</p>
        <p class="phoneNum" id="dig-5">_</p>
        <p class="phoneNum" id="dig-6">_</p>
        <p class="phoneNum">-</p>
        <p class="phoneNum" id="dig-7">_</p>
        <p class="phoneNum" id="dig-8">_</p>
        <p class="phoneNum" id="dig-9">_</p>
        <p class="phoneNum" id="dig-10">_</p> -->
    </div>

    <div class="resetSubmit">
      <button id="reset">reset</button>
      <button id="submit">submit</button>
    </div>

    <p>Flip a card to see what number it represents.</p>
    <p>Flip a card to see what number it represents.</p>
    <p>//</p>
    <p>
      NOTE: Only one card can be flipped at a time until its match is found.
    </p>

    <div class="card-container">
      <!-- <p class="card order-0">zero</p>
      <p class="card order-1">one</p>
      <p class="card order-2">two</p>
      <p class="card order-3">three</p>
      <p class="card order-4">four</p>
      <p class="card order-5">five</p>
      <p class="card order-6">six</p>
      <p class="card order-7">seven</p>
      <p class="card order-8">eight</p>
      <p class="card order-9">nine</p>

      <p class="card order-10">zero</p>
      <p class="card order-11">one</p>
      <p class="card order-12">two</p>
      <p class="card order-13">three</p>
      <p class="card order-14">four</p>
      <p class="card order-15">five</p>
      <p class="card order-16">six</p>
      <p class="card order-17">seven</p>
      <p class="card order-18">eight</p>
      <p class="card order-19">nine</p> -->
    </div>

    <!-- <script src="phone-num-final.js"></script> -->
    <script>
      let resetBtn = document
        .querySelector("#reset")
        .addEventListener("click", resetNumber);
      let submitBtn = document
        .querySelector("#submit")
        .addEventListener("click", submitNumber);
      let phoneNum = document.querySelector("#phone-num");
      let fails = 0;
      const cardContainer = document.querySelector(".card-container");
      const cardFaces = [
        "zero",
        "zero",
        "one",
        "one",
        "two",
        "two",
        "three",
        "three",
        "four",
        "four",
        "five",
        "five",
        "six",
        "six",
        "seven",
        "seven",
        "eight",
        "eight",
        "nine",
        "nine",
      ];
      const cardVals = [
        0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9,
      ];

      let cards = [];
      let flippedCards = [];
      let matchedCards = [];

      class Card {
        constructor(card, face, value, idx) {
          this.card = card;
          this.face = face.textContent; // card face (zero-nine)
          this.value = value.textContent; // card value (0-9)
          this.idx = idx;
          this.isFlipped = false;
          this.isMatched = false;
          this.card.addEventListener("click", () => {
            this.flip();
            // this.checkMatch();
          });
        }

        getValue() {
          return this.value;
        }

        flip() {
          if (this.isFlipped) {
            this.isFlipped = false;
            this.card.classList.remove("flipped");
          } else {
            this.isFlipped = true; // switches card's flip attribute\
            this.card.classList.toggle("flipped"); // toggles flipped class
            flippedCards.push(this);

            if (flippedCards.length === 2) {
              console.log(
                "2 flipped cards",
                flippedCards[0].getValue(),
                flippedCards[1].getValue()
              );
              // this.checkMatch(flippedCards[0], flippedCards[1]);
              checkMatch();
            } else {
              console.log("error adding flipped card");
            }
          }
          // this.isFlipped = true; // switches card's flip attribute\
          // this.card.classList.toggle("flipped"); // toggles flipped class
          console.log("flipped", this.face, this.value); // logs card value and face
        }

        addFlippedCard() {
          if (flippedCards.length < 2) {
            flippedCards.push(this);
            console.log("added", this);
          } else if (flippedCards.length === 2) {
            console.log(
              "2 flipped cards",
              flippedCards[0].getValue(),
              flippedCards[1].getValue()
            );
            // this.checkMatch(flippedCards[0], flippedCards[1]);
            checkMatch();
          } else {
            console.log("error adding flipped card");
          }
          // console.log("flipped cards", flippedCards.length, flippedCards);
        }

        // checkMatch() {
        //   console.log("checking match", flippedCards[0].value, flippedCards[1].value);
        //   // if (flippedCards.length === 2) {
        //     if (flippedCards[0].value === flippedCards[1].value) {
        //       flippedCards[0].match();
        //       flippedCards[1].match();
        //       matchedCards.push(flippedCards[0], flippedCards[1]);
        //     } else {
        //       fails++;
        //       setTimeout(() => {
        //         console.log("not a match", flippedCards[0].value, flippedCards[1].value);
        //         flippedCards[0].flip();
        //         flippedCards[1].flip();
        //       }, 1000); // 1s delay before flipping cards back over
        //     }
        //     flippedCards = [];
        //   // }
        // }

        match() {
          this.isMatched = true;
          this.card.classList.add("matched");
        }
      }

      /* Shuffles cards using Fisher-Yates Shuffle algorithm */
      function shuffle(nums) {
        // Iterates backwards through nums, swapping last elem with an elem at a rand lower index
        for (let i = nums.length - 1; i > 0; i--) {
          let rand = Math.floor(Math.random() * (i + 1));
          let temp = nums[i];
          nums[i] = nums[rand];
          nums[rand] = temp;
        }

        return nums;
      }

      function createCards() {
        let shuffledFaces = shuffle(cardFaces);
        // console.log(cardFaces.length);
        // console.log(shuffledFaces.length);
        let shuffledVals = shuffle(cardVals);
        // console.log(shuffledVals.length);

        for (let i = 0; i < cardFaces.length; i++) {
          const newCard = document.createElement("div");
          const cardFace = document.createElement("p");
          const cardVal = document.createElement("p");
          const idx = i;
          cardFace.textContent = shuffledFaces[i];
          cardFace.classList.add("card-face");
          cardVal.textContent = shuffledVals[i];
          cardVal.classList.add("card-back");
          newCard.classList.add("card");
          newCard.appendChild(cardFace);
          newCard.appendChild(cardVal);
          cards.push(new Card(newCard, cardFace, cardVal, idx));
          cardContainer.appendChild(newCard);
        }
      }

      function resetNumber() {
        phoneNum.textContent = "___-___-____";
      }

      function submitNumber() {
        alert("Your number is " + number.textContent);
      }

      function checkMatch() {
        console.log(
          "checking match",
          flippedCards[0].getValue(),
          flippedCards[1].getValue()
        );
        // if (flippedCards.length === 2) {
        if (flippedCards[0].getValue() === flippedCards[1].getValue()) {
          console.log("matching");
          flippedCards[0].match();
          flippedCards[1].match();
          matchedCards.push(flippedCards[0], flippedCards[1]);
        } else {
          fails++;
          console.log("fails", fails);
          setTimeout(() => {
            // console.log("not a match", flippedCards[0].getValue(), flippedCards[1].getValue());
            flippedCards[0].flip();
            flippedCards[1].flip();
          }, 1000); // 1s delay before flipping cards back over
        }
        flippedCards = [];
        // }
      }

      // function addFlippedCard(card) {
      //   flippedCards.push(card);
      //   if (flippedCards.length === 2) {
      //     // console.log("2 flipped cards", flippedCards[0].value, flippedCards[1].value);
      //     checkMatch(flippedCards[0], flippedCards[1]);
      //   }
      // }

      createCards(); // create cards
    </script>
  </body>
</html>

<!-- card matching for frustrating phone number js project -->
<!-- //
     0 1 2 3 4 5 6 7 8 9
     0 1 2 3 4 5 6 7 8 9

     0 1 2 3 4
     5 6 7 8 9
     0 1 2 3 4
     5 6 7 8 9
     
     0 1 2 3
     4 5 6 7
     8 9 0 1
     2 3 4 5
     6 7 8 9

     funtions:
        
-->
